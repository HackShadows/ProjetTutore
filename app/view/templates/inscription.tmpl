{% extends "page.tmpl" %}

{% block nav %}
{% set nav_items = nav_items + [{"target": "/connexion", "text": "Connexion"}] %}
{{ nav_tmpl.nav(nav_items, 4) }}
{% endblock %}

{% block main %}
<div class="row">
    <div class="col-12 col-lg-8">
        <h1 class="title mb-4" id="contactFormTitle">Créer un compte</h1>

		{% if error %}
            <div class="alert alert-danger alert-dismissible fade show" role="alert">
                <strong>Erreur :</strong> {{ error }}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
        {% endif %}

        <form action="/traitementInscription" method="POST" id="contactForm">
            <div class="mb-3">
                <label for="username" class="form-label">Pseudo :</label>
                <input type="text" id="username" name="username" class="form-control" value="{{ data.username }}" required>
            </div>

            <div class="mb-3">
                <label for="password" class="form-label">Mot de passe :</label>
                <div class="input-group">
                    <input type="password" id="password" name="password" class="form-control" required>
                    <button class="btn btn-outline-secondary" type="button" onclick="togglePassword('password')">
                        <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                            <path d="M16 8s-3-5.5-8-5.5S0 8 0 8s3 5.5 8 5.5S16 8 16 8M1.173 8a13 13 0 0 1 1.66-2.043C4.12 4.668 5.88 3.5 8 3.5s3.879 1.168 5.168 2.457A13 13 0 0 1 14.828 8q-.086.13-.195.288c-.335.48-.83 1.05-1.465 1.667C11.879 11.332 10.119 12.5 8 12.5s-3.879-1.168-5.168-2.457A13 13 0 0 1 1.172 8z"/>
                            <path d="M8 5.5a2.5 2.5 0 1 0 0 5 2.5 2.5 0 0 0 0-5M4.5 8a3.5 3.5 0 1 1 7 0 3.5 3.5 0 0 1-7 0"/>
                        </svg>
                    </button>
                </div>
                
                <div id="password-requirements" class="mt-3 p-3 bg-light rounded border" style="display: none;">
                    <p class="fw-bold mb-2 small text-muted">Le mot de passe doit contenir :</p>
                    <ul class="list-unstyled mb-0 small">
                        <li id="length" class="invalid text-danger">✖ 8 caractères minimum</li>
                        <li id="uppercase" class="invalid text-danger">✖ Une majuscule</li>
                        <li id="number" class="invalid text-danger">✖ Un chiffre</li>
                        <li id="special" class="invalid text-danger">✖ Un caractère spécial</li>
                    </ul>
                </div>
            </div>

            <div class="mb-3">
                <label for="confirm_password" class="form-label">Confirmer le mot de passe :</label>
                <div class="input-group">
                    <input type="password" id="confirm_password" name="confirm_password" class="form-control" required>
                    <button class="btn btn-outline-secondary" type="button" onclick="togglePassword('confirm_password')">
                        <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                            <path d="M16 8s-3-5.5-8-5.5S0 8 0 8s3 5.5 8 5.5S16 8 16 8M1.173 8a13 13 0 0 1 1.66-2.043C4.12 4.668 5.88 3.5 8 3.5s3.879 1.168 5.168 2.457A13 13 0 0 1 14.828 8q-.086.13-.195.288c-.335.48-.83 1.05-1.465 1.667C11.879 11.332 10.119 12.5 8 12.5s-3.879-1.168-5.168-2.457A13 13 0 0 1 1.172 8z"/>
                            <path d="M8 5.5a2.5 2.5 0 1 0 0 5 2.5 2.5 0 0 0 0-5M4.5 8a3.5 3.5 0 1 1 7 0 3.5 3.5 0 0 1-7 0"/>
                        </svg>
                    </button>
                </div>
            </div>

            <button type="submit" class="btn btn-primary px-4">S'inscrire</button>
        </form>

        <div class="mt-4 pt-3 border-top">
            Déjà un compte ? 
            <a href="/connexion">
                <button class="btn btn-primary ms-2">Se connecter</button>
            </a>
        </div>
    </div>
</div>
{% endblock %}

{% block js %}
<script>
	function togglePassword(id) {
        const input = document.getElementById(id);
        input.type = input.type === "password" ? "text" : "password";
    }

    const passInput = document.getElementById('password');
    const requirements = document.getElementById('password-requirements');

    passInput.addEventListener('focus', () => requirements.style.display = 'block');

    passInput.addEventListener('input', () => {
        const val = passInput.value;
        const checks = {
            length: val.length >= 8,
            uppercase: /[A-Z]/.test(val),
            number: /[0-9]/.test(val),
            special: /[!@#$%^&*(),.?":{}|<>]/.test(val)
        };

        for (const [id, passed] of Object.entries(checks)) {
            const el = document.getElementById(id);
            if (passed) {
                el.classList.replace('text-danger', 'text-success');
                el.innerText = el.innerText.replace('✖', '✔');
            } else {
                el.classList.replace('text-success', 'text-danger');
                el.innerText = el.innerText.replace('✔', '✖');
            }
        }
    });
</script>
{% endblock %}